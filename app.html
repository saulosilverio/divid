<!DOCTYPE html>
<html lang="">
<head>
	<meta charset="utf-8">
	<title>Divid</title>
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="description" content="" />
  	<meta name="keywords" content="" />
	<meta name="robots" content="" />
	<link rel="stylesheet" href="assets/css/jquery.mobile.structure-1.4.5.min.css" />
	<link rel="stylesheet" type="text/css" href="assets/css/style.css"/>
	<script src="assets/js/jquery-2.1.3.js"></script>
	<script type="text/javascript">
			$(document).on('mobileinit', function () {
		    	$.mobile.ignoreContentEnabled = true;
			});
			
        	var players = [];
			
			if(typeof(Storage) !== "undefined") {
		        if (localStorage.divid_players) {
		        	players = JSON.parse(localStorage.divid_players);
		        }
		    }
			
			function updateLocalStorage(){
				localStorage.divid_players = JSON.stringify(players);
			}
			
			function setConfiguration(){
				localStorage.divid_config = $('#config').val();
				$.mobile.navigate("#selecao-jogador", {  transition: "slide"  });
			}
			
			function addPlayer(){
				var player = new Object();
				player.name = $('#tf_name').val();
				player.position = $('#tf_position option:selected').val();
				player.skill = $('#tf_skill').val();
				players.push(player);
				$('#tf_name').val('');
				$('#tf_position').val('');
				$('#tf_skill').val('');
				refreshListPlayers();
				$.mobile.navigate("#lista-jogador", {  transition: "slide"  });
			}
			
			function dividPlayers(){
				ar_position = [];
				ar_positions_players = [];
				ar_team = [];
				//DIVIDIR POTS DE POSICOES E ORDENAR POR SKILL
				players_select = [];
				$('input.select_players:checkbox:checked').each(function () {
					players_select.push( players[$(this).val()] );
				});
				
				if(players_select.length > 0){
					for(var i=0; i<players_select.length;i++){
						if(typeof(ar_positions_players[players_select[i].position]) == "undefined") {
							ar_positions_players[players_select[i].position] = [];
						}
						ar_positions_players[players_select[i].position].push(players_select[i]);
						ar_positions_players[players_select[i].position] = multiSort(ar_positions_players[players_select[i].position]);
						if( ar_position.indexOf(players_select[i].position) < 0  ){
							ar_position.push(players_select[i].position);
						}
					}
				}
				//QTDE DE JOGADORES POR TIME
				div = (( (typeof(Storage) !== "undefined" && localStorage.divid_config) )? localStorage.divid_config : 2);
				//LOOP POSITION
				if(ar_position.length > 0){
					for(var i=0; i<ar_position.length;i++){
						team = 0;
						for(var j=0; j<ar_positions_players[ar_position[i]].length;j++){
							if(typeof(ar_team[team]) == "undefined") {
								ar_team[team] = [];
							}
							ar_team[team].push( ar_positions_players[ar_position[i]][j] );
							tmp = team+1;
							team = ( tmp >= div )? 0 : tmp;
						}
					}
				}
				
				$('#list_team').html('');
				if(ar_team.length > 0){
					for(var i=0; i<ar_team.length;i++){
						html = '<div class="time"><strong>Time '+(i+1)+'</strong><ul>';
						if(ar_team[i].length > 0){
							for(var j=0; j<ar_team[i].length;j++){
								html += '<li><span>'+ar_team[i][j].name+'</span> <small>'+ar_team[i][j].position+'</small></li>';
							}
						}
						html += '</ul></div>';
						$('#list_team').append(html);
					}
				}
				$.mobile.navigate("#equipes", {  transition: "slide"  });
			}
			
			function refreshListPlayers(){
				$('#list_players').html("");
				$('#select_players').html("");
				if(players.length > 0){
					for(var i=0; i<players.length;i++){
						$('#list_players').append(
							'<li id="index-'+i+'"><div><strong>'+players[i].name+'</strong><small>' +players[i].position+'</small></div>'+
								'<div class="nivel" data-stars="' +players[i].skill+'">'+
								    '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 11.413"><path d="M6 9.008l-3.708 2.405 1.141-4.27L0 4.359l4.413-.234L6 0l1.587 4.125L12 4.359 8.567 7.143l1.141 4.27z"/></svg>'+
								    '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 11.413"><path d="M6 9.008l-3.708 2.405 1.141-4.27L0 4.359l4.413-.234L6 0l1.587 4.125L12 4.359 8.567 7.143l1.141 4.27z"/></svg>'+
								    '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 11.413"><path d="M6 9.008l-3.708 2.405 1.141-4.27L0 4.359l4.413-.234L6 0l1.587 4.125L12 4.359 8.567 7.143l1.141 4.27z"/></svg>'+
								    '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 11.413"><path d="M6 9.008l-3.708 2.405 1.141-4.27L0 4.359l4.413-.234L6 0l1.587 4.125L12 4.359 8.567 7.143l1.141 4.27z"/></svg>'+
								    '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 11.413"><path d="M6 9.008l-3.708 2.405 1.141-4.27L0 4.359l4.413-.234L6 0l1.587 4.125L12 4.359 8.567 7.143l1.141 4.27z"/></svg>'+
							    '</div>'+
							    '<button class="btn-remove-lista"><svg class="icon"><use xlink:href="assets/img/icons.svg#remove" /></svg></button>'+
							'</li>'
						);
						
						$('#select_players').append(
							'<li>'+
								'<div class="checkbox-jogador">'+
									'<span>'+
										'<input type="checkbox" class="select_players" id="players_select'+i+'" name="players_select[]" value="'+i+'">'+
										'<label for="players_select'+i+'"></label>'+
									'</span>'+
								'</div>'+
								'<div class="info">'+
									'<div>'+
										'<strong>'+players[i].name+'</strong><small>' +players[i].position+'</small>'+
									'</div>'+
									'<div class="nivel" data-stars="' +players[i].skill+'">'+
									    '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 11.413"><path d="M6 9.008l-3.708 2.405 1.141-4.27L0 4.359l4.413-.234L6 0l1.587 4.125L12 4.359 8.567 7.143l1.141 4.27z"/></svg>'+
									    '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 11.413"><path d="M6 9.008l-3.708 2.405 1.141-4.27L0 4.359l4.413-.234L6 0l1.587 4.125L12 4.359 8.567 7.143l1.141 4.27z"/></svg>'+
									    '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 11.413"><path d="M6 9.008l-3.708 2.405 1.141-4.27L0 4.359l4.413-.234L6 0l1.587 4.125L12 4.359 8.567 7.143l1.141 4.27z"/></svg>'+
									    '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 11.413"><path d="M6 9.008l-3.708 2.405 1.141-4.27L0 4.359l4.413-.234L6 0l1.587 4.125L12 4.359 8.567 7.143l1.141 4.27z"/></svg>'+
									    '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 11.413"><path d="M6 9.008l-3.708 2.405 1.141-4.27L0 4.359l4.413-.234L6 0l1.587 4.125L12 4.359 8.567 7.143l1.141 4.27z"/></svg>'+
								    '</div>'+
								'</div>'+
							'</li>'
						);
						
					}
				}else{
					$('#list_players').append('<li class="empty"><p>Nenhum jogador cadastrado</p></li>');
				}
				updateLocalStorage();
				$('#list_players > li').on('swipeleft', swipeleftHandler);
				$('#list_players > li').on('swiperight', swiperightHandler);
				$('.btn-remove-lista').click(removeLinha);
				
			}
			
			function swipeleftHandler(event){
				event.preventDefault();
			    $(event.target).addClass('show-remove');
			}
			function swiperightHandler(event){
				event.preventDefault();
			    $(event.target).removeClass('show-remove');
			}
			function removeLinha() {
			    var linha = $(this).parent();
			    idx = $(linha).attr('id').split('-');
				players.splice(idx[1], 1);
				updateLocalStorage();
			    linha.fadeOut(1000);
			    setTimeout(function() {
			        linha.remove();
			    }, 1000);
			}
			
			$(document).ready(function() {
				
				refreshListPlayers();
				$('#btn_add').on('click', addPlayer);
				$('#salve_conf').on('click', setConfiguration);
				$('#dividir').on('click', dividPlayers);
				
				if (typeof(Storage) !== "undefined" && localStorage.divid_config) {
		        	$('#config').val(localStorage.divid_config);
		        }
			
				$('.star.rating').click(function(){
					$(this).parent().attr('data-stars', $(this).data('rating'));
					$('#tf_skill').val($(this).data('rating'));
				});
				
			});
			
	</script>
	<script src="assets/js/jquery.mobile-1.4.5.js"></script>
	<script src="assets/js/skill_sort.js"></script>
</head>
<body>
	<!-- !1 - HOME -->
	<div data-role="page" id="lista-jogador" data-enhance="false">
		<header data-role="header">
			<a href="javascript:void(0)"></a>
			<h1>Jogadores</h1>
			<a href="#add-jogador" data-transition="slide">
				<svg class="icon"><use xlink:href="assets/img/icons.svg#mais" /></svg>
			</a>
		</header>
		<section>
			<ul id="list_players" class="lista-jogadores">
			</ul>
		</section>
		<nav>
			<a href="#lista-jogador" class="active">
				<svg class="icon"><use xlink:href="assets/img/icons.svg#jogadores" /></svg>
			</a>
			<a href="#selecao-jogador">
				<svg class="icon"><use xlink:href="assets/img/icons.svg#dividir" /></svg>
			</a>
		</nav>
	</div>
	
	<!-- !2 - ADD JOGADOR -->
	<div data-role="page" id="add-jogador" data-enhance="false">
		<header data-role="header" data-enhance="false">
			<a href="#lista-jogador" data-transition="slide" data-direction="reverse"><svg class="icon"><use xlink:href="assets/img/icons.svg#seta-esq" /></svg></a>
			<h1>Adicionar Jogador</h1>
			<a href="javascript:void(0)">
			</a>
		</header>
		<section>
			<div class="field">
				<label>Nome</label>
				<input type="text" id="tf_name" name="tf_name" value="" />
			</div>
			<div class="field">
				<label>Posição</label>
				<select id="tf_position" name="tf_position">
					<option value="">Selecione</option>
			        <option value="Goleiro">Goleiro</option>
			        <option value="Zagueiro">Zagueiro</option>
			        <option value="Lateral">Lateral</option>
			        <option value="Meia">Meia</option>
			        <option value="Atacante">Atacante</option>
				</select>
			</div>
			<div class="field">
				<label>Técnica</label>
				<div>
					<input type="hidden" id="tf_skill" name="tf_skill" value="" />
					<div class="stars" data-stars="0">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 11.413" class="star rating" data-rating="1">
							<path d="M6 9.008l-3.708 2.405 1.141-4.27L0 4.359l4.413-.234L6 0l1.587 4.125L12 4.359 8.567 7.143l1.141 4.27z"/>
						</svg>
					    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 11.413" class="star rating" data-rating="2">
						    <path d="M6 9.008l-3.708 2.405 1.141-4.27L0 4.359l4.413-.234L6 0l1.587 4.125L12 4.359 8.567 7.143l1.141 4.27z"/>
						</svg>
					    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 11.413" class="star rating" data-rating="3">
						    <path d="M6 9.008l-3.708 2.405 1.141-4.27L0 4.359l4.413-.234L6 0l1.587 4.125L12 4.359 8.567 7.143l1.141 4.27z"/>
						</svg>
					    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 11.413" class="star rating" data-rating="4">
						    <path d="M6 9.008l-3.708 2.405 1.141-4.27L0 4.359l4.413-.234L6 0l1.587 4.125L12 4.359 8.567 7.143l1.141 4.27z"/>
						</svg>
					    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 11.413" class="star rating" data-rating="5">
						    <path d="M6 9.008l-3.708 2.405 1.141-4.27L0 4.359l4.413-.234L6 0l1.587 4.125L12 4.359 8.567 7.143l1.141 4.27z"/>
						</svg>
					</div>
				</div>
			</div>
			<button type="button" id="btn_add" data-transition="slide" data-direction="reverse">Adicionar</button>
		</section>
	</div>
	
	<!-- !4 - SELECAO DOS JOGADORES -->
	<div data-role="page" id="selecao-jogador" data-enhance="false">
		<header>
			<a href="javascript:void(0)"></a>
			<h1>Dividir equipes</h1>
			<a href="#configuracoes" data-transition="slide"><svg class="icon"><use xlink:href="assets/img/icons.svg#config" /></svg></a>
		</header>
		<section>
			<ul id="select_players" class="selecao-jogadores"></ul>
			<button id="dividir" type="button" data-transition="slide" data-role="button">Dividir</button>
		</section>
		<nav>
			<a href="#lista-jogador">
				<svg class="icon"><use xlink:href="assets/img/icons.svg#jogadores" /></svg>
			</a>
			<a href="#selecao-jogador" class="active">
				<svg class="icon"><use xlink:href="assets/img/icons.svg#dividir" /></svg>
			</a>
		</nav>
	</div>
	
	<!-- !5 - CONFIGURACOES -->
	<div data-role="page" id="configuracoes" data-enhance="false">
		<header>
			<a href="#selecao-jogador" data-transition="slide" data-direction="reverse"><svg class="icon"><use xlink:href="assets/img/icons.svg#seta-esq" /></svg></a>
			<h1>Configurações</h1>
			<a href="javascript:void(0)"></a>
		</header>
		<section>
			<div class="field">
				<label>Participantes por time</label>
				<input type="number" id="config" name="config" value="" />
			</div>
			<button type="button" id="salve_conf" data-transition="slide" data-direction="reverse" data-role="button">Ok</button>
		</section>
	</div>
	
	<!-- !6 - EQUIPES -->
	<div data-role="page" id="equipes" data-enhance="false">
		<header>
			<a href="#" data-transition="slide" data-direction="reverse" data-rel="back"><svg class="icon"><use xlink:href="assets/img/icons.svg#seta-esq" /></svg></a>
			<h1>Equipes</h1>
			<a href="javascript:void(0)"></a>
		</header>
		<section>
			<div id="list_team" class="container-times">
			</div>		
		</section>
	</div>
</body>
</html>